<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="baidu-site-verification" content="1EB8XoOl0C"><meta name="google-site-verification" content="K7thEgdLm0UfRWJ5MGdF7sCcjClSzAlxFLPv2Oz5CGM"><title> Vue-router · KyleSun的个人博客</title><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="Vue-router - KyleSun"><meta name="keywords"><meta name="author" content="KyleSun"><link rel="short icon" href="https://files.catbox.moe/n63k73.png"><link rel="stylesheet" href="https://bubuzou.oss-cn-shenzhen.aliyuncs.com/blog/202010/bubuzou.css"><link rel="search" type="application/opensearchdescription+xml" href="http://example.com/atom.xml" title="KyleSun的个人博客"><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='//unpkg.com/valine/dist/Valine.min.js'></script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="KyleSun的个人博客" type="application/atom+xml">
</head><body><header><div class="header row"> <a href="/" class="logo-link"><img src="https://files.catbox.moe/n63k73.png"></a><ul id="nav_list" class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" data-hover="博文" class="nav-list-link">博文</a></li><li class="nav-list-item"><a href="/archives/" target="_self" data-hover="归档" class="nav-list-link">归档</a></li><li class="nav-list-item"><a href="/live/" target="_self" data-hover="生活" class="nav-list-link">生活</a></li><li class="nav-list-item"><a href="/read/" target="_self" data-hover="读书" class="nav-list-link">读书</a></li><li class="nav-list-item"><a href="/about/" target="_self" data-hover="关于" class="nav-list-link">关于</a></li></ul><div class="search"><a id="search_btn" href="#search"></a></div><div id="nav_btn" class="nav-btn"><span></span><span></span><span></span></div></div></header><div class="row scroll-con"><section class="container"><!-- for archive page--><div id="postAr" class="post"><article class="post-block"><h1 class="post-title">Vue-router</h1><div class="post-info">2023-10-31<p class="visit"><i data-identity="2023/10/31/7. Vue-router/" class="article-timer"></i><span>次访问</span></p></div><div class="post-content"><p>##1. 简介</p>
<blockquote>
<p>Vue Router（通常称为 vue-router）是Vue.js的官方路由管理库，用于实现前端路由。Vue Router使你能够创建单页面应用（SPA），将不同的组件与URL进行关联，以便用户在应用程序中导航。以下是Vue Router的基本</p>
</blockquote>
<p>##2. 使用教程</p>
<p>####步骤1: 安装Vue Router</p>
<p>首先，确保你的Vue.js项目已经安装了Vue Router。如果你是使用Vue CLI创建的项目，通常Vue Router会自动包含在项目中。如果没有，你可以通过以下方式进行安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install vue-router</span><br></pre></td></tr></table></figure>

<p>或者使用Yarn：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add vue-router</span><br></pre></td></tr></table></figure>

<p>####步骤2: 创建路由配置</p>
<p>在你的项目中创建一个路由配置（route&#x2F;index.js），定义路由的路径和关联的组件。通常，你会将路由配置放在一个单独的文件中。以下是一个简单的路由配置示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// router/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VueRouter</span> <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Home</span> <span class="keyword">from</span> <span class="string">&#x27;@/views/Home.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">About</span> <span class="keyword">from</span> <span class="string">&#x27;@/views/About.vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">VueRouter</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">Home</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/about&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">About</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">  routes,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br></pre></td></tr></table></figure>

<p>####步骤3: 关联Vue实例</p>
<p>在你的Vue应用程序中，你需要将Vue Router与Vue实例关联，以便它能够控制你的应用的路由。通常，你会在主入口文件（例如<code>main.js</code>）中执行此操作：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">render</span>: <span class="function"><span class="params">h</span> =&gt;</span> <span class="title function_">h</span>(<span class="title class_">App</span>),</span><br><span class="line">  router, <span class="comment">// 将路由器与Vue实例关联</span></span><br><span class="line">&#125;).$mount(<span class="string">&#x27;#app&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>####步骤4: 创建路由视图</p>
<p>在你的应用程序中，创建与路由关联的组件，并将它们渲染为路由视图。路由视图是在不同路由之间切换时显示的内容区域。你可以在Vue组件中使用 <code>&lt;router-view&gt;</code> 标签来显示路由视图。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- App.vue --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;app&quot;&gt;</span><br><span class="line">    &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<p>####步骤5: 创建导航链接</p>
<p>为了让用户能够导航到不同的路由，你可以创建导航链接。Vue Router提供了 <code>&lt;router-link&gt;</code> 组件，用于创建内部导航链接。以下是一个简单的示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;router-link to=&quot;/&quot;&gt;Home&lt;/router-link&gt;</span><br><span class="line">&lt;router-link to=&quot;/about&quot;&gt;About&lt;/router-link&gt;</span><br></pre></td></tr></table></figure>

<p>####步骤6: 导航守卫</p>
<p>Vue Router提供了导航守卫，你可以使用它们来添加路由导航的拦截和处理逻辑。你可以在路由配置中定义全局守卫、路由独享的守卫以及组件内的守卫。</p>
<p>以下是一个全局前置守卫的示例，它在每次路由切换前执行：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">  routes,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 在每次路由切换前执行的逻辑</span></span><br><span class="line">  <span class="title function_">next</span>(); <span class="comment">// 一定要调用 next() 来继续路由导航</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这是一个简单的Vue Router使用教程，帮助你开始创建具有路由功能的Vue.js应用程序。根据你的项目需求，你可以添加更多高级功能，如嵌套路由、路由参数、路由懒加载等。请查阅Vue Router的官方文档以获取更多详细信息：<a target="_blank" rel="noopener" href="https://router.vuejs.org/">Vue Router 官方文档</a>。</p>
<p>##3. 嵌套路由</p>
<blockquote>
<p>嵌套路由是一种在Vue Router中创建子路由的技术，允许你在一个父路由内嵌套多个子路由。这对于构建复杂的页面布局以及在不同的嵌套级别上组织组件非常有用。</p>
</blockquote>
<p>###步骤1：定义路由配置</p>
<p>首先，你需要在路由配置中定义父路由和子路由。父路由通常是页面的整体布局，而子路由用于在父路由内呈现不同的内容。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">Layout</span>, <span class="comment">// 父路由组件</span></span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 子路由的路径为空，作为默认子路由</span></span><br><span class="line">        <span class="attr">component</span>: <span class="title class_">Home</span>, <span class="comment">// 子路由组件</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;about&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="title class_">About</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 其他子路由</span></span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 其他路由配置</span></span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>###步骤2：创建路由视图组件</p>
<p>在父路由组件和子路由组件中，你需要创建Vue组件，以便在路由切换时呈现内容。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Layout.vue --&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h1&gt;Layout&lt;/h1&gt;</span><br><span class="line">    &lt;router-view&gt;&lt;/router-view&gt; &lt;!-- 子路由组件将被渲染在这里 --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">vueCopy code</span><br><span class="line">&lt;!-- Home.vue --&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h2&gt;Home Page&lt;/h2&gt;</span><br><span class="line">    &lt;!-- Home 页面内容 --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">vueCopy code</span><br><span class="line">&lt;!-- About.vue --&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h2&gt;About Page&lt;/h2&gt;</span><br><span class="line">    &lt;!-- About 页面内容 --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<p>###步骤3：设置路由链接</p>
<p>你可以使用 <code>&lt;router-link&gt;</code> 组件创建导航链接，以便用户可以导航到不同的子路由。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Layout.vue 或其他父路由组件 --&gt;</span><br><span class="line"></span><br><span class="line">&lt;router-link to=&quot;/&quot;&gt;Home&lt;/router-link&gt;</span><br><span class="line">&lt;router-link to=&quot;/about&quot;&gt;About&lt;/router-link&gt;</span><br></pre></td></tr></table></figure>

<p>###步骤4：导航到子路由</p>
<p>现在，当用户点击导航链接时，Vue Router将会根据路径切换到相应的子路由，该子路由将在父路由的 <code>&lt;router-view&gt;</code> 中呈现。</p>
<p>这就是嵌套路由的基本使用方法。你可以在父路由中定义更多的子路由，以构建复杂的页面布局和导航。请查阅Vue Router官方文档以了解更多关于嵌套路由的高级用法和选项：<a target="_blank" rel="noopener" href="https://router.vuejs.org/guide/essentials/nested-routes.html">Vue Router 嵌套路由</a>。</p>
<p>##4. 路由参数（声明式导航）</p>
<p>在Vue Router中，你可以使用不同的方式来传递参数，包括<strong>查询参数（Query Parameters）</strong>和<strong>动态路由（Dynamic Routing）</strong>。这两种方法都可以用于在路由之间传递数据，但适用于不同的使用场景。</p>
<p>查询参数适用于在URL中传递参数，适用于不同路由之间的通用参数。而动态路由适用于根据参数值定位到不同的路由，并在组件内部使用参数。选择哪种方式取决于你的项目需求。通常，<strong>查询参数</strong>更适合用于筛选、排序、分页等功能，而<strong>动态路由</strong>更适合用于页面间的导航和路由跳转。</p>
<p>###4.1 查询参数传参</p>
<p>查询参数是附加在URL中的键值对，通常出现在URL的问号后面（例如：<code>http://example.com/route?param1=value1&amp;param2=value2</code>）。</p>
<ul>
<li><strong>传递查询参数：</strong></li>
</ul>
<p>使用 <code>&lt;router-link&gt;</code> 或编程方式导航时，你可以将查询参数附加到路由中。</p>
<p>使用 <code>&lt;router-link&gt;</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;router-link :to=&quot;&#123; path: &#x27;/route&#x27;, query: &#123; param1: &#x27;value1&#x27;, param2: &#x27;value2&#x27; &#125; &#125;&quot;&gt;Go to Route&lt;/router-link&gt;</span><br></pre></td></tr></table></figure>

<p>或者，使用编程方式：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123; <span class="attr">path</span>: <span class="string">&#x27;/route&#x27;</span>, <span class="attr">query</span>: &#123; <span class="attr">param1</span>: <span class="string">&#x27;value1&#x27;</span>, <span class="attr">param2</span>: <span class="string">&#x27;value2&#x27;</span> &#125; &#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>接收查询参数：</strong></li>
</ul>
<p>在目标组件中，你可以通过 <code>$route.query</code> 来访问查询参数的值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;p&gt;Param1: &#123;&#123; $route.query.param1 &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;Param2: &#123;&#123; $route.query.param2 &#125;&#125;&lt;/p&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<p>###4.2 动态路由传参</p>
<p>动态路由允许你在路由路径中包含参数，这些参数可以在路由匹配时传递到组件中。</p>
<ul>
<li><strong>定义动态路由：</strong>在路由配置中，你可以使用冒号 <code>:</code> 来定义动态参数。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/route/:param1/:param2&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">YourComponent</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>传递动态参数：</strong>在使用 <code>&lt;router-link&gt;</code> 或编程方式导航时，你可以为动态参数提供相应的值。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;router-link :to=&quot;&#123; path: &#x27;/route/value1/value2&#x27; &#125;&quot;&gt;Go to Route&lt;/router-link&gt;</span><br></pre></td></tr></table></figure>

<p>或者，使用编程方式：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123; <span class="attr">path</span>: <span class="string">&#x27;/route/value1/value2&#x27;</span> &#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>接收动态参数：</strong>在目标组件中，你可以通过 <code>$route.params</code> 来访问动态参数的值。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;p&gt;Param1: &#123;&#123; $route.params.param1 &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;Param2: &#123;&#123; $route.params.param2 &#125;&#125;&lt;/p&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  //在js中需要使用this关键字</span><br><span class="line">	this.$route.params.param2</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>参数可选符</strong>：</li>
</ul>
<p>当我们使用动态路由传参时，如果路由中配置了参数，则我们必须要传递参数，否则就会出现显示空白的情况。若我们希望参数可以选择性传递，则需要在配置路由时添加参数可选符——“ ? “。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/route/:param1?&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">YourComponent</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<h3 id="4-3-小结"><a href="#4-3-小结" class="headerlink" title="4.3 小结"></a>4.3 小结</h3><table>
<thead>
<tr>
<th align="left">方式</th>
<th>传递参数</th>
<th>接收参数</th>
<th>配置路由</th>
</tr>
</thead>
<tbody><tr>
<td align="left">查询参数传参</td>
<td>to &#x3D; “&#x2F;path?参数名&#x3D;值&amp;参数名&#x3D;值”</td>
<td>$route.query.参数名</td>
<td>无</td>
</tr>
<tr>
<td align="left">动态路由传参</td>
<td>to &#x3D; “&#x2F;path&#x2F;参数名”</td>
<td>$route.params.参数名</td>
<td>path:”&#x2F;path&#x2F;参数名”</td>
</tr>
</tbody></table>
<h2 id="5-路由重定向"><a href="#5-路由重定向" class="headerlink" title="5. 路由重定向"></a>5. 路由重定向</h2><p>路由重定向是一种Vue Router中的常见用法，它允许你在导航到某个路由时，自动将用户重定向到另一个路由。这可以用于多种情况，例如在用户访问某个路径时自动跳转到登录页、实现别名路由、或者重定向到默认页面等。</p>
<p>###5.1 使用 <code>redirect</code> 属性</p>
<p>在路由配置中，你可以为某个路由配置 <code>redirect</code> 属性，将其值设置为要重定向到的路由路径。这会将用户从一个路由自动导航到另一个路由。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/old-path&#x27;</span>,</span><br><span class="line">    <span class="attr">redirect</span>: <span class="string">&#x27;/new-path&#x27;</span>, <span class="comment">// 将用户重定向到 /new-path</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 其他路由配置</span></span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>###5.2 使用命名路由</p>
<p>如果你使用了命名路由，你可以在 <code>redirect</code> 属性中使用命名路由来执行重定向。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/old-path&#x27;</span>,</span><br><span class="line">    <span class="attr">redirect</span>: &#123; <span class="attr">name</span>: <span class="string">&#x27;new-route-name&#x27;</span> &#125;, <span class="comment">// 通过命名路由重定向</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 其他路由配置</span></span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>###5.3 使用函数</p>
<p>你还可以在 <code>redirect</code> 属性中使用一个函数，以编程方式决定要重定向到的路由。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/old-path&#x27;</span>,</span><br><span class="line">    <span class="attr">redirect</span>: <span class="function">(<span class="params">to</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 在这里编写逻辑，根据 to 对象来决定重定向的路由</span></span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;/new-path&#x27;</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 其他路由配置</span></span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>###5.4 路由别名</p>
<p>Vue Router还提供了路由别名的功能，允许你将某个路由设置为另一个路由的别名，当用户访问别名路由时，实际上是访问了目标路由。这可以被认为是一种路由重定向，但更为简单。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/alias-path&#x27;</span>, <span class="comment">// 路由别名</span></span><br><span class="line">    <span class="attr">alias</span>: <span class="string">&#x27;/target-path&#x27;</span>, <span class="comment">// 设置别名为 /target-path</span></span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">SomeComponent</span>, <span class="comment">// 显示的组件</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 其他路由配置</span></span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>通过路由别名，用户可以访问 <code>/alias-path</code> 或 <code>/target-path</code>，它们将显示相同的组件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/old-path&#x27;</span>,</span><br><span class="line">    <span class="attr">redirect</span>: <span class="string">&#x27;/new-path&#x27;</span>, <span class="comment">// 将用户重定向到 /new-path</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// 其他路由配置</span></span><br><span class="line">  &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<h2 id="6-编程式导航"><a href="#6-编程式导航" class="headerlink" title="6. 编程式导航"></a>6. 编程式导航</h2><p>###6.1 路由跳转</p>
<p>编程式导航是通过JavaScript代码来手动执行路由导航，通常使用 <code>$router</code> 对象的方法，如 <code>push</code>、<code>replace</code>、<code>go</code> 等。它通常用于以下情况：</p>
<ul>
<li>当你需要在响应事件、异步操作或特定逻辑之后手动执行路由导航。</li>
<li>当你需要传递参数、执行条件导航或在导航完成后执行额外的操作时。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="title function_">navigateToAboutPage</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(<span class="string">&#x27;/about&#x27;</span>); <span class="comment">// 编程式导航到 About 页面</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//完整写法</span></span><br><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="title function_">navigateToAboutPage</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123;</span><br><span class="line">      <span class="attr">path</span>:<span class="string">&#x27;路由路径&#x27;</span></span><br><span class="line">    &#125;); </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-2-路由传参"><a href="#6-2-路由传参" class="headerlink" title="6.2 路由传参"></a>6.2 路由传参</h3><ul>
<li><strong>使用 <code>params</code> 传递参数（动态路由传参）：</strong></li>
</ul>
<p>步骤1：<strong>在路由配置中定义动态路由</strong>：首先，需要在路由配置中定义一个带有动态参数的路由。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">javascriptCopy code</span><br><span class="line">const routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: &#x27;/user/:id&#x27;,</span><br><span class="line">    component: UserProfile,</span><br><span class="line">  &#125;,</span><br><span class="line">  // 其他路由配置</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>步骤2：执行编程式导航并传递参数**：使用 <code>$router.push()</code> 方法来执行编程式导航，并在其中传递参数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123; <span class="attr">path</span>: <span class="string">&#x27;/user/123&#x27;</span> &#125;); <span class="comment">// 传递参数，将用户ID设置为123</span></span><br></pre></td></tr></table></figure>

<p>步骤3：<strong>接收参数的组件中访问参数</strong>：在目标组件中，你可以通过 <code>$route.params</code> 来访问传递的参数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;p&gt;User ID: &#123;&#123; $route.params.id &#125;&#125;&lt;/p&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>使用 <code>query</code> 传递参数（查询参数传参）：</strong></li>
</ul>
<p><strong>步骤1：执行编程式导航并传递参数</strong>：使用 <code>$router.push()</code> 方法来执行编程式导航，并在其中传递参数作为查询参数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123; </span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/user&#x27;</span>, </span><br><span class="line">  <span class="attr">query</span>: &#123; <span class="attr">id</span>: <span class="number">123</span> &#125; </span><br><span class="line">&#125;); <span class="comment">// 传递参数，将用户ID设置为123</span></span><br></pre></td></tr></table></figure>

<p><strong>步骤2：在接收参数的组件中访问参数</strong>：在目标组件中，你可以通过 <code>$route.query</code> 来访问传递的查询参数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;p&gt;User ID: &#123;&#123; $route.query.id &#125;&#125;&lt;/p&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<p>这是两种使用编程式导航传递参数的常见方法。你可以根据你的需求和路由配置选择其中一种方式。一般来说，使用 <code>params</code> 适用于将参数嵌入到URL中，而使用 <code>query</code> 适用于更灵活的参数传递，例如在表单提交后传递数据。如果需要更多复杂的参数传递，你还可以结合这两种方法来使用。</p>
<p>##7. 路由懒加载</p>
<p>路由懒加载（Route Lazy Loading）是一种优化Vue.js应用性能的技术。通过路由懒加载，你可以延迟加载你的路由组件，<strong>只在用户访问特定路由时才加载相关的代码</strong>。这可以减小初始加载的包大小，加快应用的初始加载速度，特别是对于大型单页应用（SPA）来说非常有用。在Vue.js中，你可以使用以下方法实现路由懒加载：</p>
<h3 id="7-1-使用动态导入（Dynamic-Import）"><a href="#7-1-使用动态导入（Dynamic-Import）" class="headerlink" title="7.1 使用动态导入（Dynamic Import）"></a>7.1 使用动态导入（Dynamic Import）</h3><p>动态导入是ECMAScript的一部分，它允许你按需加载模块。在Vue.js中，你可以结合Webpack的动态导入来实现路由懒加载。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">Home</span> = (<span class="params"></span>) =&gt; <span class="keyword">import</span>(<span class="string">&#x27;./views/Home.vue&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">About</span> = (<span class="params"></span>) =&gt; <span class="keyword">import</span>(<span class="string">&#x27;./views/About.vue&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>这里的<code>import</code>语句会将路由组件按需加载，只有在用户访问相关路由时才加载相应的组件。</p>
<h3 id="7-2-使用Webpack的require-ensure"><a href="#7-2-使用Webpack的require-ensure" class="headerlink" title="7.2 使用Webpack的require.ensure"></a>7.2 使用Webpack的require.ensure</h3><p>在较早的Vue.js版本中，你可以使用Webpack的<code>require.ensure</code>来实现路由懒加载。不过，现代Vue.js项目通常更推荐使用动态导入。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">Home</span> = resolve =&gt; <span class="built_in">require</span>.<span class="title function_">ensure</span>([], <span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="built_in">require</span>(<span class="string">&#x27;./views/Home.vue&#x27;</span>)));</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">About</span> = resolve =&gt; <span class="built_in">require</span>.<span class="title function_">ensure</span>([], <span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="built_in">require</span>(<span class="string">&#x27;./views/About.vue&#x27;</span>)));</span><br></pre></td></tr></table></figure>

<p>无论你选择哪种方法，路由懒加载的效果是一样的，即在用户访问相关路由时才加载相应的路由组件。这可以显著减小初始加载的包大小，提高应用的性能。确保你的应用使用现代构建工具（如Webpack）以及Vue Router的支持，以便轻松实现路由懒加载。</p>
<h2 id="8-导航守卫"><a href="#8-导航守卫" class="headerlink" title="8. 导航守卫"></a>8. 导航守卫</h2><p>当使用 Vue Router 来管理路由的时候，导航守卫允许你在路由切换的不同阶段执行特定操作。下面将更详细地介绍导航守卫的使用和用途：</p>
<p>###8.1 全局前置守卫 (<code>beforeEach</code>)：</p>
<ul>
<li>全局前置守卫是在路由切换前执行的，通常用于进行身份验证和权限检查。</li>
<li>你可以在 <code>router</code> 对象上使用 <code>beforeEach</code> 钩子，以全局方式应用于所有路由。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (to.<span class="property">meta</span>.<span class="property">requiresAuth</span> &amp;&amp; !userIsAuthenticated) &#123;</span><br><span class="line">    <span class="title function_">next</span>(<span class="string">&#x27;/login&#x27;</span>); <span class="comment">// 重定向到登录页</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">next</span>(); <span class="comment">// 允许继续导航</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>###8.2 全局解析守卫 (<code>beforeResolve</code>)：**</p>
<ul>
<li>全局解析守卫在导航成功被确认之前执行，常用于等待异步操作的完成。</li>
<li><code>beforeResolve</code> 钩子在全局前置守卫之后、路由组件渲染之前执行。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">beforeResolve</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 在导航成功前执行一些操作</span></span><br><span class="line">  <span class="title function_">next</span>();</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>###8.3 全局后置守卫 (<code>afterEach</code>)：</p>
<ul>
<li>全局后置守卫在路由导航完成后执行，通常用于执行一些全局操作，如日志记录或分析。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">javascriptCopy code</span><br><span class="line">router.<span class="title function_">afterEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 在路由导航完成后执行操作</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>###8.4 路由独享的守卫：</p>
<ul>
<li>你可以在路由配置中设置 <code>beforeEnter</code> 来指定只在特定路由上执行的守卫。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> adminRoute = &#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/admin&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="title class_">AdminComponent</span>,</span><br><span class="line">  <span class="attr">beforeEnter</span>: <span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (userIsAdmin) &#123;</span><br><span class="line">      <span class="title function_">next</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">next</span>(<span class="string">&#x27;/access-denied&#x27;</span>); <span class="comment">// 重定向到拒绝访问页</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>###8.5 组件内的守卫 (<code>beforeRouteEnter</code>, <code>beforeRouteUpdate</code>, <code>beforeRouteLeave</code>)：**</p>
<ul>
<li>组件内的守卫允许你在组件生命周期中定义特定的路由导航逻辑。</li>
<li><code>beforeRouteEnter</code> 在路由进入组件前执行，但此时组件实例还未被创建。</li>
<li><code>beforeRouteUpdate</code> 在路由参数变化时执行。</li>
<li><code>beforeRouteLeave</code> 在组件离开前执行。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">MyComponent</span> = &#123;</span><br><span class="line">  <span class="title function_">beforeRouteEnter</span>(<span class="params">to, <span class="keyword">from</span>, next</span>) &#123;</span><br><span class="line">    <span class="comment">// 在组件进入前执行，但组件实例还未创建</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">beforeRouteUpdate</span>(<span class="params">to, <span class="keyword">from</span>, next</span>) &#123;</span><br><span class="line">    <span class="comment">// 路由参数变化时执行</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">beforeRouteLeave</span>(<span class="params">to, <span class="keyword">from</span>, next</span>) &#123;</span><br><span class="line">    <span class="comment">// 在组件离开前执行</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>导航守卫是非常有用的工具，用于控制路由的行为，实现身份验证、权限控制和其他路由导航逻辑。你可以根据应用程序的需求，在不同阶段执行特定的操作来实现自定义的路由控制逻辑。</p>
</div></article></div><div class="right-container"><div class="widget"><div id="arAnchorBar"></div></div></div></section></div><div class="right-menu"></div><div class="modal search-modal"><div class="input-field"><input type="text" id="search_input"><label for="search-input">搜索</label></div><div id="search_result" class="search-result"></div></div><div class="blog-overlay"></div><footer class="row"><div class="footer-con"><div class="paginator"><a href="/2023/10/31/5.%20Vue%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/" title="Vue生命周期" class="prev">PREV</a><a href="/2023/10/31/8.%20Vue-resource/" title="Vue-resource" class="next">NEXT</a></div><div class="copyright"><p>© 2023 <a target="_blank">KyleSun</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> <br> and <a href="https://github.com/Bulandent/hexo-theme-bubuzou" target="_blank">hexo-theme-bubuzou</a></p><p> <span style="padding-right: 6px;">闽ICP备16007301号-2</span></p></div><div class="totop"><i></i></div></div></footer><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script src="https://bubuzou.oss-cn-shenzhen.aliyuncs.com/blog/202010/jquery-1.8.2.min.js"></script><script src="https://bubuzou.oss-cn-shenzhen.aliyuncs.com/blog/202010/articleCatalog.js"></script><script src="https://bubuzou.oss-cn-shenzhen.aliyuncs.com/blog/202010/main.js"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script><script>const valineAPI = (() => {
try {
    AV.init("aD8jJBpu4oew3ovNY73z6Rdq-gzGzoHsz", "FdzS5SOPHdhYQoEUngQ8K2QW");
} catch(error) {}
const isExist = (identity) => {
    identity = identity || getRealPath();
    let query = new AV.Query('Timer');
    return new Promise((resolve, reject) => {
    query.equalTo("identity", identity);
    query.find().then(results => {
        resolve(results.length > 0);
    }, error => reject(error));
    })
}

const _get = (identity) => {
    let query = null;
    if(identity && identity instanceof Array){
    let querys = [];
    for(let i = 0; i < identity.length; ++i) {
        querys[i] = new AV.Query('Timer');
        querys[i].equalTo('identity', identity[i]);
    }
    query = AV.Query.or.apply(null ,querys);
    } else {
    identity = identity || getRealPath();
    query = new AV.Query("Timer");
    query.equalTo("identity", identity);
    }

    return new Promise((resolve, reject) => {
    query.find()
    .then(results => resolve(results))
    .catch(error => reject(error))
    })
}

const create = (identity) => {
    identity = identity || getRealPath();
    return new Promise((resolve, reject) => {
    let Todo = AV.Object.extend('Timer');
    let todo = new Todo();
    todo.set("times", 1);
    todo.set("identity", identity);
    todo.save().then(res => resolve(true), error => reject(error));
    })
}

const update = (identity) => {
    identity = identity || getRealPath();
    return new Promise((resolve, reject) => {
    let query = new AV.Query('Timer');
    query.equalTo("identity", identity);
    query.find().then(todos => {
        todos.forEach(todo => {
        todo.set("times", todo.attributes.times + 1);
        });
        return AV.Object.saveAll(todos);
    }).then(todos => resolve(true), error => reject(error));
    })
}

return {
    isExist,
    _get,
    update,
    create
}
})()

const calcAndWriteTimes = () => {
let isPost = true;

let timerAllDOM = document.querySelectorAll(".article-timer");

if(isPost) {
    let identity = timerAllDOM[0].getAttribute("data-identity");
    valineAPI.isExist(identity)
    .then(exist => {
    if(exist) {
        return valineAPI.update(identity);
    }
    return new Promise(resolve => resolve(true));
    })
    .then( succuess => valineAPI._get(identity))
    .then( result => timerAllDOM[0].innerText = result[0].attributes.times)
    .catch(error => console.log(error.message))
    return ;
}

let timerDOMCache = {};

for(let timerDOM of timerAllDOM) {
    let identity = timerDOM.getAttribute("data-identity");
    if(timerDOMCache.hasOwnProperty(identity)){
    timerDOMCache[identity].dom.push(timerDOM);
    }else{
    timerDOMCache[identity] = {
        dom: [timerDOM],
        times: undefined
    };
    }
}

let identities = Object.keys(timerDOMCache);
valineAPI._get(identities).then(results => {
    for(let result of results) {
    let {identity, times} = result.attributes;
    timerDOMCache[identity].times = times;
    timerDOMCache[identity].dom.map(item => item.innerText = times);
    }
    for(let identity of identities) {
    if(timerDOMCache[identity].times){
        continue;
    }
    timerDOMCache[identity].dom.map(item => item.innerText = 1);
    valineAPI.create(identity);
    }
}).catch(error => console.log(error.message))
}

if(true){
calcAndWriteTimes();
}</script></body></html>